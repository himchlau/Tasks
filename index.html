<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>å¦™éº—æ­²æ•¸è¨ˆç®—æ©Ÿï½œç‹—ç‹—å¹´é½¡æ›ç®—äººé¡å¹´é½¡</title>
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        "Noto Sans TC", sans-serif;
    }

    body {
      margin: 0;
      min-height: 100vh;
      background: url("https://hackmd.io/_uploads/Hyc4usZlWe.png") no-repeat center center fixed;
      background-size: cover;
    }

    /* âœ… ç¸®å°è¨ˆç®—æ©Ÿ + å›ºå®šåœ¨å³ä¸Šè§’ */
    .card {
      position: fixed;
      top: 12px;
      right: 12px;
      background: rgba(255, 255, 255, 0.96);
      padding: 16px 18px 20px;
      border-radius: 16px;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.25);
      max-width: 340px;
      width: 100%;
    }

    h1 {
      margin-top: 0;
      margin-bottom: 4px;
      font-size: 1.3rem;
      text-align: center;
    }

    .subtitle {
      text-align: center;
      font-size: 0.8rem;
      color: #777;
      margin-bottom: 14px;
    }

    .label {
      margin-bottom: 4px;
      font-size: 0.85rem;
      font-weight: 600;
      color: #444;
    }

    .row {
      display: flex;
      gap: 6px;
      margin-bottom: 10px;
    }

    select {
      flex: 1;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 0.85rem;
      background-color: #fff;
    }

    button {
      width: 100%;
      padding: 8px 10px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 600;
      background: linear-gradient(135deg, #ff9a9e, #fecf66);
      color: #4a2a00;
      margin-top: 2px;
      transition: transform 0.1s ease, box-shadow 0.1s ease;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.18);
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 7px 16px rgba(0, 0, 0, 0.22);
    }

    button:active {
      transform: translateY(1px);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.25);
    }

    .result {
      margin-top: 10px;
      padding: 8px 10px;
      border-radius: 10px;
      background: #fff8e1;
      border: 1px solid #ffe0b2;
      font-size: 0.88rem;
      line-height: 1.5;
      color: #5a3a00;
      min-height: 40px;
    }

    .result-title {
      font-weight: 700;
      margin-bottom: 2px;
    }

    .note {
      margin-top: 8px;
      font-size: 0.72rem;
      color: #999;
      line-height: 1.4;
    }

    @media (max-width: 600px) {
      .card {
        top: 8px;
        right: 8px;
        left: 8px;
        max-width: none;
      }
    }
  </style>

<!--  æ”¾å…¥é€™ä¸‰è¡Œé–‹å§‹ -->
<link rel="icon" type="image/png" href="./icon.png">
<link rel="apple-touch-icon" href="./icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="./icon.png">
<!--  æ”¾å…¥é€™ä¸‰è¡ŒçµæŸ -->

</head>
<body>
  <div class="card">
    <h1>å¦™éº—æ­²æ•¸è¨ˆç®—æ©Ÿ</h1>
    <div class="subtitle">ç”¨ä¸­å‹çŠ¬ã€Œ15â€“9â€“5ã€è¦å‰‡ï¼Œæ›ç®—å¦™éº—çš„ç‹—ç‹—æ­²æ•¸èˆ‡äººé¡å¹´é½¡</div>

    <div class="label">è«‹é¸æ“‡å¦™éº—çš„å‡ºç”Ÿæ—¥æœŸï¼š</div>
    <div class="row">
      <select id="yearSelect"></select>
      <select id="monthSelect"></select>
      <select id="daySelect"></select>
    </div>

    <button id="calcBtn">å¹«å¦™éº—ç®—æ­²æ•¸ ğŸ¾</button>

    <div id="result" class="result">
      è«‹å…ˆé¸æ“‡å¦™éº—çš„å‡ºç”Ÿæ—¥æœŸï¼Œç„¶å¾ŒæŒ‰ä¸‹æŒ‰éˆ•ã€‚
    </div>

    <div class="note">
      æ¼”ç®—æ³•èªªæ˜ï¼š<br>
      â€§ ç¬¬ 1 å€‹ç‹—å¹´ â‰ˆ 15 å€‹äººå¹´<br>
      â€§ ç¬¬ 2 å€‹ç‹—å¹´ â‰ˆ å†åŠ  9 å€‹äººå¹´ï¼ˆå…±ç´„ 24 äººå¹´ï¼‰<br>
      â€§ ä¹‹å¾Œæ¯å¤š 1 ç‹—å¹´ â‰ˆ å†åŠ ç´„ 4â€“5 äººå¹´ï¼ˆæ­¤è™•ä»¥ 4 äººå¹´ä½œç‚ºä¸­å‹çŠ¬è¿‘ä¼¼å€¼ï¼‰<br>
      â€§ å¯¦éš›å¹´é½¡æœƒä¾å€‹é«”å·®ç•°ã€é«”é‡èˆ‡å“ç¨®ä¸åŒè€Œç•¥æœ‰å‡ºå…¥ã€‚
    </div>
  </div>

  <script>
    const yearSelect = document.getElementById('yearSelect');
    const monthSelect = document.getElementById('monthSelect');
    const daySelect = document.getElementById('daySelect');
    const resultDiv = document.getElementById('result');
    const calcBtn = document.getElementById('calcBtn');

    /* âœ… localStorage keyï¼šç”¨ä¾†è¨˜ä½ä¸Šæ¬¡ç”Ÿæ—¥ */
    const STORAGE_KEY = 'miaoliBirthDate';

    function addOption(select, value, text) {
      const opt = document.createElement('option');
      opt.value = value;
      opt.textContent = text;
      select.appendChild(opt);
    }

    function resetDayOptions(daysInMonth = 31) {
      daySelect.innerHTML = '';
      addOption(daySelect, '', 'æ—¥');
      for (let d = 1; d <= daysInMonth; d++) {
        addOption(daySelect, d, d + ' æ—¥');
      }
    }

    function updateDays() {
      const year = parseInt(yearSelect.value, 10);
      const month = parseInt(monthSelect.value, 10);

      if (!year || !month) {
        resetDayOptions(31);
        return;
      }

      const daysInMonth = new Date(year, month, 0).getDate();
      resetDayOptions(daysInMonth);
    }

    function initDateSelectors() {
      const today = new Date();
      const currentYear = today.getFullYear();
      const startYear = currentYear - 25;

      addOption(yearSelect, '', 'å¹´');
      for (let y = currentYear; y >= startYear; y--) {
        addOption(yearSelect, y, y + ' å¹´');
      }

      addOption(monthSelect, '', 'æœˆ');
      for (let m = 1; m <= 12; m++) {
        addOption(monthSelect, m, m + ' æœˆ');
      }

      resetDayOptions(31);
    }

    /* âœ… å¾ localStorage è¼‰å…¥ç”Ÿæ—¥ï¼ˆåˆ·æ–°å¾Œæ²¿ç”¨ï¼‰ */
    function loadBirthDateFromStorage() {
      try {
        const stored = localStorage.getItem(STORAGE_KEY);
        if (!stored) return;
        const data = JSON.parse(stored);
        const { year, month, day } = data || {};

        if (year && month) {
          if ([...yearSelect.options].some(o => Number(o.value) === Number(year))) {
            yearSelect.value = year;
          }
          if ([...monthSelect.options].some(o => Number(o.value) === Number(month))) {
            monthSelect.value = month;
          }

          updateDays();

          if (day && [...daySelect.options].some(o => Number(o.value) === Number(day))) {
            daySelect.value = day;
          }
        }
      } catch (e) {
        console.warn('è®€å–å¦™éº—å‡ºç”Ÿæ—¥æœŸå¤±æ•—ï¼š', e);
      }
    }

    /* âœ… å„²å­˜ç”Ÿæ—¥åˆ° localStorage */
    function saveBirthDateToStorage(year, month, day) {
      try {
        const data = { year, month, day };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      } catch (e) {
        console.warn('å„²å­˜å¦™éº—å‡ºç”Ÿæ—¥æœŸå¤±æ•—ï¼š', e);
      }
    }

    yearSelect.addEventListener('change', updateDays);
    monthSelect.addEventListener('change', updateDays);

    function calculateDogYears(birthDate, today) {
      const diffMs = today - birthDate;
      if (diffMs < 0) return null;

      const diffDays = diffMs / (1000 * 60 * 60 * 24);
      return diffDays / 365.25;
    }

    // ä¸­å‹çŠ¬ 15â€“9â€“4 è¦å‰‡ï¼ˆé€£çºŒç‰ˆï¼‰
    function dogToHumanAge(dogYears) {
      if (dogYears <= 0) return 0;
      if (dogYears <= 1) {
        return 15 * dogYears;
      } else if (dogYears <= 2) {
        return 15 + 9 * (dogYears - 1);
      } else {
        return 24 + 4 * (dogYears - 2);
      }
    }

    calcBtn.addEventListener('click', () => {
      const year = parseInt(yearSelect.value, 10);
      const month = parseInt(monthSelect.value, 10);
      const day = parseInt(daySelect.value, 10);

      if (!year || !month || !day) {
        resultDiv.innerHTML = '<span class="result-title">è«‹ç¢ºèªï¼š</span>è«‹å®Œæ•´é¸æ“‡ã€Œå¹´ã€æœˆã€æ—¥ã€å–”ï¼';
        return;
      }

      const birthDate = new Date(year, month - 1, day);
      const today = new Date();

      const dogYears = calculateDogYears(birthDate, today);
      if (dogYears === null) {
        resultDiv.innerHTML = '<span class="result-title">Oopsï¼</span> å‡ºç”Ÿæ—¥æœŸå¥½åƒåœ¨æœªä¾†ï¼Œè«‹é‡æ–°ç¢ºèªã€‚';
        return;
      }

      const humanYears = dogToHumanAge(dogYears);

      const dogYearsDisplay = dogYears.toFixed(1);
      const humanYearsDisplay = Math.round(humanYears);

      resultDiv.innerHTML =
        '<div class="result-title">è¨ˆç®—çµæœï¼š</div>' +
        'å¦™éº—ç¾åœ¨å¤§ç´„ <strong>' + dogYearsDisplay + '</strong> æ­²ç‹—å¹´é½¡ï¼Œ<br>' +
        'æ›ç®—æˆäººé¡å¹´é½¡å¤§ç´„æ˜¯ <strong>' + humanYearsDisplay + '</strong> æ­²ã€‚';

      // âœ… è¨ˆç®—æˆåŠŸå¾Œï¼Œè¨˜ä½ç”Ÿæ—¥
      saveBirthDateToStorage(year, month, day);
    });

    // âœ… åˆå§‹åŒ– + å¾ localStorage è¼‰å…¥ä¹‹å‰çš„ç”Ÿæ—¥
    initDateSelectors();
    loadBirthDateFromStorage();
  </script>
</body>
</html>
